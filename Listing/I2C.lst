C51 COMPILER V9.00   I2C                                                                   07/19/2018 22:35:42 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE I2C
OBJECT MODULE PLACED IN .\Output\I2C.obj
COMPILER INVOKED BY: E:\Program Files\keil5\C51\BIN\C51.EXE Drivers\I2C.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PR
                    -INT(.\Listing\I2C.lst) TABS(2) OBJECT(.\Output\I2C.obj)

line level    source

   1          /*****************************************************************
   2          **                   大连理工大学 创新创业学院
   3          **                       物联网应用工坊
   4          **---------------------------------------------------------------
   5          ** 项目名称：   WTZP1.0-BlueBerry
   6          ** 日    期：   2018-07-08
   7          ** 作    者：   温武军
   8          **---------------------------------------------------------------
   9          ** 文 件 名：   I2C.c
  10          ** 文件说明：   调用单片机内I2C通信模块（目前只有端口3）
  11          *****************************************************************/
  12          
  13          /*---------------------INCLUDES----------------------*/
  14          #include "I2C.h"
  15          
  16          /*---------------------VARIABLES---------------------*/
  17          
  18          
  19          /*---------------------FUNCTIONS---------------------*/
  20          /***********************************************************************
  21          ** 函 数 名： InitI2C()
  22          ** 函数说明： 使能I2C主机（此处使能端口3）
  23          **---------------------------------------------------------------------
  24          ** 输入参数： 无
  25          ** 返回参数： 无
  26          ***********************************************************************/
  27          void InitI2C()
  28          {
  29   1        P_SW2=0xB0;
  30   1        I2CCFG = 0xe0;//时钟数选择端口                              
  31   1        I2CMSST = 0x00;
  32   1      }
  33          /***********************************************************************
  34          ** 函 数 名： Wait()
  35          ** 函数说明： 查询等待函数
  36          **---------------------------------------------------------------------
  37          ** 输入参数： 无
  38          ** 返回参数： 无
  39          ***********************************************************************/
  40          void Wait()
  41          {
  42   1        while(!(I2CMSST&0x40));//卡住了
  43   1        I2CMSST&=~0x40;
  44   1      }
  45          /***********************************************************************
  46          ** 函 数 名： Start()
  47          ** 函数说明： 发送START命令
  48          **---------------------------------------------------------------------
  49          ** 输入参数： 无
  50          ** 返回参数： 无
  51          ***********************************************************************/
  52          void Start()
  53          {
  54   1        I2CMSCR=0x01;
C51 COMPILER V9.00   I2C                                                                   07/19/2018 22:35:42 PAGE 2   

  55   1        Wait();
  56   1      }
  57          /***********************************************************************
  58          ** 函 数 名： SendData(unsigned char dat)
  59          ** 函数说明： 写数据到数据缓冲区，并发送
  60          **---------------------------------------------------------------------
  61          ** 输入参数： uint8
  62          ** 返回参数： 无
  63          ***********************************************************************/
  64          void SendData(unsigned char dat)
  65          {
  66   1        I2CTXD=dat;//
  67   1        I2CMSCR=0x02;
  68   1        Wait();
  69   1      }
  70          /***********************************************************************
  71          ** 函 数 名： RecvACK()
  72          ** 函数说明： 发送ACK命令
  73          **---------------------------------------------------------------------
  74          ** 输入参数： 无
  75          ** 返回参数： 无
  76          ***********************************************************************/
  77          void RecvACK()
  78          {
  79   1        I2CMSCR=0x03;
  80   1        Wait();
  81   1      }
  82          /***********************************************************************
  83          ** 函 数 名： RecvData()
  84          ** 函数说明： 发送RECV命令,并接收数据
  85          **---------------------------------------------------------------------
  86          ** 输入参数： 无
  87          ** 返回参数： uint8
  88          ***********************************************************************/
  89          uint8 RecvData()
  90          {
  91   1        I2CMSCR = 0x04;                             
  92   1        Wait();
  93   1        return I2CRXD;
  94   1      }
  95          /***********************************************************************
  96          ** 函 数 名： SendACK()
  97          ** 函数说明： 设置ACK信号,发送ACK命令
  98          **---------------------------------------------------------------------
  99          ** 输入参数： 无
 100          ** 返回参数： 无
 101          ***********************************************************************/
 102          void SendACK()
 103          {
 104   1        I2CMSST = 0x00;                             
 105   1        I2CMSCR = 0x05;                             
 106   1        Wait();
 107   1      }
 108          /***********************************************************************
 109          ** 函 数 名： SendNAK()
 110          ** 函数说明： 设置NCK信号,发送ACK信号
 111          **---------------------------------------------------------------------
 112          ** 输入参数： 无
 113          ** 返回参数： 无
 114          ***********************************************************************/
 115          void SendNAK()
 116          {
C51 COMPILER V9.00   I2C                                                                   07/19/2018 22:35:42 PAGE 3   

 117   1        I2CMSST = 0x01;                             
 118   1        I2CMSCR = 0x05;                             
 119   1        Wait();
 120   1      }
 121          /***********************************************************************
 122          ** 函 数 名： Stop()
 123          ** 函数说明： 发送STOP命令
 124          **---------------------------------------------------------------------
 125          ** 输入参数： 无
 126          ** 返回参数： 无
 127          ***********************************************************************/
 128          void Stop()
 129          {
 130   1        I2CMSCR = 0x06;                             
 131   1        Wait();
 132   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    115    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
