C51 COMPILER V9.00   URSTTEST                                                              08/02/2018 18:09:54 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE URSTTEST
OBJECT MODULE PLACED IN .\Output\UrstTest.obj
COMPILER INVOKED BY: E:\Program Files\keil5\C51\BIN\C51.EXE Drivers\UrstTest.c LARGE OPTIMIZE(8,SPEED) BROWSE DEBUG OBJE
                    -CTEXTEND PRINT(.\Listing\UrstTest.lst) TABS(2) OBJECT(.\Output\UrstTest.obj)

line level    source

   1          /*****************************************************************
   2          **                   大连理工大学 创新创业学院
   3          **                       物联网应用工坊
   4          **---------------------------------------------------------------
   5          ** 项目名称：   WTZP1.0-BlueBerry
   6          ** 日    期：   2018-07-08
   7          ** 作    者：   温武军
   8          **---------------------------------------------------------------
   9          ** 文 件 名：   UrstTest.c
  10          ** 文件说明：   串口异步通讯
  11          ** 更新日志：   2018-7-14 串口1,2,3都可用了
  12          *****************************************************************/
  13          
  14          /*---------------------INCLUDES----------------------*/
  15          #include "UrstTest.h"
  16          
  17          /*---------------------VARIABLES---------------------*/
  18          uint8 Urst2Rec=0;
  19          uint8 Urst2TI=0;
  20          uint8 Urst2RI=0;
  21          uint8 Urst3TI=0;
  22          uint8 Urst3RI=0;
  23          uint8 Urst3Rec=0;
  24          
  25          /*---------------------FUNCTIONS---------------------*/
  26          /***********************************************************************
  27          ** 函 数 名： InitUart1()
  28          ** 函数说明： 串口1异步通信初始化程序，选择定时器1
  29          **---------------------------------------------------------------------
  30          ** 输入参数： 无
  31          ** 返回参数： 无
  32          ***********************************************************************/
  33          void InitUart1()
  34          {
  35   1        SCON = 0x50; //(0101 0000) 工作方式为方式1,允许接收
  36   1        InitTime1();                                                                  
  37   1      }
  38          /***********************************************************************
  39          ** 函 数 名： UartSend1(unsigned char dat)
  40          ** 函数说明： 单字节发送程序
  41          **---------------------------------------------------------------------
  42          ** 输入参数： uint8
  43          ** 返回参数： 无
  44          ***********************************************************************/
  45          //
  46          void UartSend1(unsigned char dat)
  47          {
  48   1        SBUF=dat;
  49   1        while(!TI);
  50   1        TI=0;
  51   1      }
  52          /***********************************************************************
  53          ** 函 数 名： UartSend1_Byte(unsigned long int dat,unsigned char n)
  54          ** 函数说明： 多字节发送程序//先送低8位再送高8位
C51 COMPILER V9.00   URSTTEST                                                              08/02/2018 18:09:54 PAGE 2   

  55          **---------------------------------------------------------------------
  56          ** 输入参数： uint32（发送数据），uint8（发送数据字节数）
  57          ** 返回参数： 无
  58          ***********************************************************************/
  59          void UartSend1_Byte(unsigned long dat,unsigned char n)
  60          {
  61   1        unsigned char i,ch;
  62   1        for(i=0;i<n;i++)
  63   1        {
  64   2          ch=dat;
  65   2          UartSend1(ch);
  66   2          dat=dat>>8;
  67   2        }
  68   1      }
  69          /***********************************************************************
  70          ** 函 数 名： UartSend1_str((char *dat)
  71          ** 函数说明： 多字节发送程序//先送低8位再送高8位
  72          **---------------------------------------------------------------------
  73          ** 输入参数： uint8（发送字符串的首地址）
  74          ** 返回参数： 无
  75          ***********************************************************************/
  76          void UartSend1_str(char *dat) 
  77          {
  78   1        while(*dat)
  79   1        {
  80   2          UartSend1(*dat);
  81   2          dat++;
  82   2        }
  83   1      }
  84          /***********************************************************************
  85          ** 函 数 名： InitUart2()
  86          ** 函数说明： 串口1异步通信初始化程序，选择定时器1
  87          **---------------------------------------------------------------------
  88          ** 输入参数： 无
  89          ** 返回参数： 无
  90          ***********************************************************************/
  91          void InitUart2()
  92          {
  93   1        S2CON = 0x50; //(0001 0000) 允许接收,9位数据，有起始与终止位 
  94   1        InitTime2();                                                                  
  95   1      }
  96          /***********************************************************************
  97          ** 函 数 名： UartSend2(unsigned char dat)
  98          ** 函数说明： 单字节发送程序
  99          **---------------------------------------------------------------------
 100          ** 输入参数： uint8
 101          ** 返回参数： 无
 102          ***********************************************************************/
 103          void UartSend2(char dat)
 104          {
 105   1        S2BUF=dat;
 106   1        Urst2TI=1;
 107   1        while(Urst2TI);
 108   1      }
 109          /***********************************************************************
 110          ** 函 数 名： UartSend2_str(char *dat)
 111          ** 函数说明： 多字节发送程序//先送低8位再送高8位
 112          **---------------------------------------------------------------------
 113          ** 输入参数： uint8（发送字符串的首地址）
 114          ** 返回参数： 无
 115          ***********************************************************************/
 116          void UartSend2_str(char *dat) 
C51 COMPILER V9.00   URSTTEST                                                              08/02/2018 18:09:54 PAGE 3   

 117          {
 118   1        while(*dat)
 119   1        {
 120   2          UartSend2(*dat);
 121   2          dat++;
 122   2        }
 123   1      }
 124          /***********************************************************************
 125          ** 函 数 名： UartRec2()
 126          ** 函数说明： 字符串接收程序
 127          **---------------------------------------------------------------------
 128          ** 输入参数： 接收字符串首地址
 129          ** 返回参数： uint8
 130          ***********************************************************************/
 131          uint8 UartRec2(char *p)
 132          {
 133   1        while(Urst2RI)
 134   1        {
 135   2          Urst2RI=0;
 136   2          Urst2Rec = S2BUF;
 137   2          *p=Urst2Rec;
 138   2          if(*p){Urst2RI=1;p++;}
 139   2          else  {Urst2RI=0;*p=0;return 1;}
 140   2        }
 141   1        return 0;
 142   1      }
 143          /***********************************************************************
 144          ** 函 数 名： InitUart3()
 145          ** 函数说明： 串口3异步通信初始化程序，选择定时器3
 146          **---------------------------------------------------------------------
 147          ** 输入参数： 无
 148          ** 返回参数： 无
 149          ***********************************************************************/
 150          void InitUart3(void)
 151          {
 152   1        S3CON |= 0x40;    //串口3选择定时器3为波特率发生器
 153   1        InitTime3();
 154   1      }
 155          /***********************************************************************
 156          ** 函 数 名： UartSend3(unsigned char dat)
 157          ** 函数说明： 单字节发送程序
 158          **---------------------------------------------------------------------
 159          ** 输入参数： uint8
 160          ** 返回参数： 无
 161          ***********************************************************************/
 162          void UartSend3(unsigned char dat)
 163          {
 164   1        S3BUF=dat;
 165   1        Urst3TI=1;
 166   1        while(Urst3TI);
 167   1      }
 168          /***********************************************************************
 169          ** 函 数 名： UartSend3_str(char *dat)
 170          ** 函数说明： 多字节发送程序//先送低8位再送高8位
 171          **---------------------------------------------------------------------
 172          ** 输入参数： uint8（发送字符串的首地址）
 173          ** 返回参数： 无
 174          ***********************************************************************/
 175          void UartSend3_str(char *dat)
 176          {
 177   1        while(*dat)
 178   1        {
C51 COMPILER V9.00   URSTTEST                                                              08/02/2018 18:09:54 PAGE 4   

 179   2          UartSend3(*dat++);
 180   2        }
 181   1      }
 182          /***********************************************************************
 183          ** 函 数 名： UartRec3()
 184          ** 函数说明： 字符串接收程序
 185          **---------------------------------------------------------------------
 186          ** 输入参数： 接收字符
 187          ** 返回参数： uint8 接收字符串的首地址
 188          ***********************************************************************/
 189          uint8 UartRec3(char *p)
 190          {
 191   1        while(Urst3RI)
 192   1        {
 193   2          Urst3RI=0;
 194   2          Urst3Rec = S3BUF;
 195   2          *p=Urst3Rec;
 196   2          if(*p){Urst3RI=1;p++;}
 197   2          else  {Urst3RI=0;*p=0;return 1;}
 198   2        }
 199   1        return 0;
 200   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    302    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =      6       8
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
