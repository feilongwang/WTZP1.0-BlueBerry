C51 COMPILER V9.00   URSTTEST                                                              07/20/2018 11:36:09 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE URSTTEST
OBJECT MODULE PLACED IN .\Output\UrstTest.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE Drivers\UrstTest.c LARGE OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRI
                    -NT(.\Listing\UrstTest.lst) TABS(2) OBJECT(.\Output\UrstTest.obj)

line level    source

   1          /*****************************************************************
   2          **                   大连理工大学 创新创业学院
   3          **                       物联网应用工坊
   4          **---------------------------------------------------------------
   5          ** 项目名称：   WTZP1.0-BlueBerry
   6          ** 日    期：   2018-07-08
   7          ** 作    者：   温武军
   8          **---------------------------------------------------------------
   9          ** 文 件 名：   UrstTest.c
  10          ** 文件说明：   串口异步通讯
  11          ** 更新日志：   2018-7-14 串口0，1都可用了
  12          *****************************************************************/
  13          
  14          /*---------------------INCLUDES----------------------*/
  15          #include "UrstTest.h"
  16          
  17          /*---------------------VARIABLES---------------------*/
  18          uint8 Urst2Rec;
  19          uint8 Urst2busy=0;
  20          
  21          /*---------------------FUNCTIONS---------------------*/
  22          /***********************************************************************
  23          ** 函 数 名： InitUart1()
  24          ** 函数说明： 串口1异步通信初始化程序，选择定时器1
  25          **---------------------------------------------------------------------
  26          ** 输入参数： 无
  27          ** 返回参数： 无
  28          ***********************************************************************/
  29          void InitUart1()
  30          {
  31   1        SCON = 0x50; //(0101 0000) 工作方式为方式1,允许接收
  32   1        InitTime1();                                                                  
  33   1      }
  34          /***********************************************************************
  35          ** 函 数 名： UartSend1(unsigned char dat)
  36          ** 函数说明： 单字节发送程序
  37          **---------------------------------------------------------------------
  38          ** 输入参数： uint8
  39          ** 返回参数： 无
  40          ***********************************************************************/
  41          //
  42          void UartSend1(unsigned char dat)
  43          {
  44   1        SBUF=dat;
  45   1        while(!TI);
  46   1        TI=0;
  47   1      }
  48          /***********************************************************************
  49          ** 函 数 名： UartSend1_Byte(unsigned long int dat,unsigned char n)
  50          ** 函数说明： 多字节发送程序//先送低8位再送高8位
  51          **---------------------------------------------------------------------
  52          ** 输入参数： uint32（发送数据），uint8（发送数据字节数）
  53          ** 返回参数： 无
  54          ***********************************************************************/
C51 COMPILER V9.00   URSTTEST                                                              07/20/2018 11:36:09 PAGE 2   

  55          void UartSend1_Byte(unsigned long dat,unsigned char n)
  56          {
  57   1        unsigned char i,ch;
  58   1        for(i=0;i<n;i++)
  59   1        {
  60   2          ch=dat;
  61   2          UartSend1(ch);
  62   2          dat=dat>>8;
  63   2        }
  64   1      }
  65          /***********************************************************************
  66          ** 函 数 名： UartSend1_str((char *dat)
  67          ** 函数说明： 多字节发送程序//先送低8位再送高8位
  68          **---------------------------------------------------------------------
  69          ** 输入参数： uint8（发送字符串的首地址）
  70          ** 返回参数： 无
  71          ***********************************************************************/
  72          void UartSend1_str(char *dat) 
  73          {
  74   1        while(*dat)
  75   1        {
  76   2          UartSend1(*dat);
  77   2          dat++;
  78   2        }
  79   1      }
  80          /***********************************************************************
  81          ** 函 数 名： InitUart2()
  82          ** 函数说明： 串口1异步通信初始化程序，选择定时器1
  83          **---------------------------------------------------------------------
  84          ** 输入参数： 无
  85          ** 返回参数： 无
  86          ***********************************************************************/
  87          void InitUart2()
  88          {
  89   1        S2CON = 0x50; //(0001 0000) 允许接收,9位数据，有起始与终止位 
  90   1        InitTime2();                                                                  
  91   1      }
  92          /***********************************************************************
  93          ** 函 数 名： UartSend2(unsigned char dat)
  94          ** 函数说明： 单字节发送程序
  95          **---------------------------------------------------------------------
  96          ** 输入参数： uint8
  97          ** 返回参数： 无
  98          ***********************************************************************/
  99          void UartSend2(char dat)
 100          {
 101   1        S2BUF=dat;
 102   1        while(!(S2CON & 0x02));
 103   1        S2CON &= ~0x02;
 104   1      }
 105          /***********************************************************************
 106          ** 函 数 名： UartSend2_str((char *dat)
 107          ** 函数说明： 多字节发送程序//先送低8位再送高8位
 108          **---------------------------------------------------------------------
 109          ** 输入参数： uint8（发送字符串的首地址）
 110          ** 返回参数： 无
 111          ***********************************************************************/
 112          void UartSend2_str(char *dat) 
 113          {
 114   1        while(*dat)
 115   1        {
 116   2          UartSend2(*dat);
C51 COMPILER V9.00   URSTTEST                                                              07/20/2018 11:36:09 PAGE 3   

 117   2          dat++;
 118   2        }
 119   1      }
 120          /***********************************************************************
 121          ** 函 数 名： UartRec2()
 122          ** 函数说明： 字符接收程序
 123          **---------------------------------------------------------------------
 124          ** 输入参数： 无
 125          ** 返回参数： uint8
 126          ***********************************************************************/
 127          uint8 UartRec2()
 128          {
 129   1        if(S2CON & 0x01)
 130   1        {
 131   2          S2CON &= ~0x01;
 132   2          Urst2Rec = S2BUF;
 133   2          return Urst2Rec;
 134   2        }
 135   1        return 0;
 136   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    148    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =      2       5
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
