C51 COMPILER V9.00   URSTTEST                                                              08/28/2018 17:24:43 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE URSTTEST
OBJECT MODULE PLACED IN .\Output\UrstTest.obj
COMPILER INVOKED BY: E:\Program Files\keil5\C51\BIN\C51.EXE Drivers\UrstTest.c LARGE OPTIMIZE(8,SPEED) BROWSE DEBUG OBJE
                    -CTEXTEND PRINT(.\Listing\UrstTest.lst) TABS(2) OBJECT(.\Output\UrstTest.obj)

line level    source

   1          /*****************************************************************
   2          **                   大连理工大学 创新创业学院
   3          **                       物联网应用工坊
   4          **---------------------------------------------------------------
   5          ** 项目名称：   WTZP1.0-BlueBerry
   6          ** 日    期：   2018-07-08
   7          ** 作    者：   温武军
   8          **---------------------------------------------------------------
   9          ** 文 件 名：   UrstTest.c
  10          ** 文件说明：   串口异步通讯
  11          ** 更新日志：   2018-7-14 串口1,2,3都可用了
  12          *****************************************************************/
  13          
  14          /*---------------------INCLUDES----------------------*/
  15          #include "UrstTest.h"
  16          
  17          /*---------------------VARIABLES---------------------*/
  18          uint8 Urst2Rec=0;
  19          uint8 Urst2TI=0;
  20          uint8 Urst2RI=0;
  21          uint8 Urst3TI=0;
  22          uint8 Urst3RI=0;
  23          uint8 Urst3Rec=0;
  24          
  25          /*---------------------FUNCTIONS---------------------*/
  26          /***********************************************************************
  27          ** 函 数 名： InitUart1()
  28          ** 函数说明： 串口1异步通信初始化程序，选择定时器1
  29          **---------------------------------------------------------------------
  30          ** 输入参数： 无
  31          ** 返回参数： 无
  32          ***********************************************************************/
  33          void InitUart1()
  34          {
  35   1        SCON = 0x50; //(0101 0000) 工作方式为方式1,允许接收
  36   1        InitTime1();  
  37   1      }
  38          /***********************************************************************
  39          ** 函 数 名： UartSend1(unsigned char dat)
  40          ** 函数说明： 单字节发送程序
  41          **---------------------------------------------------------------------
  42          ** 输入参数： uint8
  43          ** 返回参数： 无
  44          ***********************************************************************/
  45          //
  46          void UartSend1(unsigned char dat)
  47          {
  48   1        SBUF=dat;
  49   1        while(!TI);
  50   1        TI=0;
  51   1      }
  52          /***********************************************************************
  53          ** 函 数 名： UartSend1_Byte(unsigned long int dat,unsigned char n)
  54          ** 函数说明： 多字节发送程序//先送低8位再送高8位
C51 COMPILER V9.00   URSTTEST                                                              08/28/2018 17:24:43 PAGE 2   

  55          **---------------------------------------------------------------------
  56          ** 输入参数： uint32（发送数据），uint8（发送数据字节数）
  57          ** 返回参数： 无
  58          ***********************************************************************/
  59          void UartSend1_Byte(unsigned long dat,unsigned char n)
  60          {
  61   1        unsigned char i,ch;
  62   1        for(i=0;i<n;i++)
  63   1        {
  64   2          ch=dat;
  65   2          UartSend1(ch);
  66   2          dat=dat>>8;
  67   2        }
  68   1      }
  69          /***********************************************************************
  70          ** 函 数 名： UartSend1_str((char *dat)
  71          ** 函数说明： 多字节发送程序//先送低8位再送高8位
  72          **---------------------------------------------------------------------
  73          ** 输入参数： uint8（发送字符串的首地址）
  74          ** 返回参数： 无
  75          ***********************************************************************/
  76          void UartSend1_str(char *dat) 
  77          {
  78   1        while(*dat)
  79   1        {
  80   2          UartSend1(*dat);
  81   2          dat++;
  82   2        }
  83   1      }
  84          /***********************************************************************
  85          ** 函 数 名： UartRec1()
  86          ** 函数说明： 字符串接收程序(查询法)
  87          **---------------------------------------------------------------------
  88          ** 输入参数： 接收字符串首地址
  89          ** 返回参数： uint8
  90          ***********************************************************************/
  91          /*uint8 UartRec1(char *p)
  92          {
  93            uint8 i;
  94            {
  95              RI=0;
  96              p[i] = SBUF;
  97              if(p[i]){RI=1;i++;}
  98              else  {RI=0;i=0;return 1;}
  99            }while(RI);
 100          }*/
 101          /***********************************************************************
 102          ** 函 数 名： InitUart2()
 103          ** 函数说明： 串口1异步通信初始化程序，选择定时器1
 104          **---------------------------------------------------------------------
 105          ** 输入参数： 无
 106          ** 返回参数： 无
 107          ***********************************************************************/
 108          void InitUart2()
 109          {
 110   1        S2CON = 0x50; //(0001 0000) 允许接收,9位数据，有起始与终止位 
 111   1        InitTime2();                                                                  
 112   1      }
 113          /***********************************************************************
 114          ** 函 数 名： UartSend2(unsigned char dat)
 115          ** 函数说明： 单字节发送程序
 116          **---------------------------------------------------------------------
C51 COMPILER V9.00   URSTTEST                                                              08/28/2018 17:24:43 PAGE 3   

 117          ** 输入参数： uint8
 118          ** 返回参数： 无
 119          ***********************************************************************/
 120          void UartSend2(char dat)
 121          {
 122   1        S2BUF=dat;
 123   1        Urst2TI=1;
 124   1        while(Urst2TI);
 125   1      }
 126          /***********************************************************************
 127          ** 函 数 名： UartSend2_str(char *dat)
 128          ** 函数说明： 多字节发送程序//先送低8位再送高8位
 129          **---------------------------------------------------------------------
 130          ** 输入参数： uint8（发送字符串的首地址）
 131          ** 返回参数： 无
 132          ***********************************************************************/
 133          void UartSend2_str(char *dat) 
 134          {
 135   1        while(*dat)
 136   1        {
 137   2          UartSend2(*dat);
 138   2          dat++;
 139   2        }
 140   1      }
 141          /***********************************************************************
 142          ** 函 数 名： UartRec2()
 143          ** 函数说明： 字符串接收程序(查询法)
 144          **---------------------------------------------------------------------
 145          ** 输入参数： 接收字符串首地址
 146          ** 返回参数： uint8
 147          ***********************************************************************/
 148          /*uint8 UartRec2(char *p)
 149          {
 150            while(Urst2RI)
 151            {
 152              Urst2RI=0;
 153              Urst2Rec = S2BUF;
 154              *p=Urst2Rec;
 155              if(*p){Urst2RI=1;p++;}
 156              else  {Urst2RI=0;*p=0;return 1;}
 157            }
 158            return 0;
 159          }*/
 160          /***********************************************************************
 161          ** 函 数 名： InitUart3()
 162          ** 函数说明： 串口3异步通信初始化程序，选择定时器3
 163          **---------------------------------------------------------------------
 164          ** 输入参数： 无
 165          ** 返回参数： 无
 166          ***********************************************************************/
 167          void InitUart3(void)
 168          {
 169   1        InitTime3();
 170   1        S3CON |= 0x40;    //串口3选择定时器3为波特率发生器
 171   1      }
 172          /***********************************************************************
 173          ** 函 数 名： UartSend3(unsigned char dat)
 174          ** 函数说明： 单字节发送程序
 175          **---------------------------------------------------------------------
 176          ** 输入参数： uint8
 177          ** 返回参数： 无
 178          ***********************************************************************/
C51 COMPILER V9.00   URSTTEST                                                              08/28/2018 17:24:43 PAGE 4   

 179          void UartSend3(unsigned char dat)
 180          {
 181   1        S3BUF=dat;
 182   1        Urst3TI=1;
 183   1        while(Urst3TI);
 184   1      }
 185          /***********************************************************************
 186          ** 函 数 名： UartSend3_str(char *dat)
 187          ** 函数说明： 多字节发送程序//先送低8位再送高8位
 188          **---------------------------------------------------------------------
 189          ** 输入参数： uint8（发送字符串的首地址）
 190          ** 返回参数： 无
 191          ***********************************************************************/
 192          void UartSend3_str(char *dat)
 193          {
 194   1        while(*dat)
 195   1        {
 196   2          UartSend3(*dat++);
 197   2        }
 198   1      }
 199          /***********************************************************************
 200          ** 函 数 名： UartRec3()
 201          ** 函数说明： 字符串接收程序(查询法)
 202          **---------------------------------------------------------------------
 203          ** 输入参数： 接收字符
 204          ** 返回参数： uint8 接收字符串的首地址
 205          ***********************************************************************/
 206          /*uint8 UartRec3(char *p)
 207          {
 208            while(Urst3RI)
 209            {
 210              Urst3RI=0;
 211              Urst3Rec = S3BUF;
 212              *p=Urst3Rec;
 213              if(*p){Urst3RI=1;p++;}
 214              else  {Urst3RI=0;*p=0;return 1;}
 215            }
 216            return 0;
 217          }*/


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    205    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =      6       8
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
