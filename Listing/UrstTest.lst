C51 COMPILER V9.00   URSTTEST                                                              07/20/2018 15:42:50 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE URSTTEST
OBJECT MODULE PLACED IN .\Output\UrstTest.obj
COMPILER INVOKED BY: E:\Program Files\keil5\C51\BIN\C51.EXE Drivers\UrstTest.c LARGE OPTIMIZE(8,SPEED) BROWSE DEBUG OBJE
                    -CTEXTEND PRINT(.\Listing\UrstTest.lst) TABS(2) OBJECT(.\Output\UrstTest.obj)

line level    source

   1          /*****************************************************************
   2          **                   大连理工大学 创新创业学院
   3          **                       物联网应用工坊
   4          **---------------------------------------------------------------
   5          ** 项目名称：   WTZP1.0-BlueBerry
   6          ** 日    期：   2018-07-08
   7          ** 作    者：   温武军
   8          **---------------------------------------------------------------
   9          ** 文 件 名：   UrstTest.c
  10          ** 文件说明：   串口异步通讯
  11          ** 更新日志：   2018-7-14 串口0，1都可用了
  12          *****************************************************************/
  13          
  14          /*---------------------INCLUDES----------------------*/
  15          #include "UrstTest.h"
  16          
  17          /*---------------------VARIABLES---------------------*/
  18          uint8 Urst2Rec;
  19          uint8 Urst2TI=0;
  20          uint8 Urst2RI=0;
  21          
  22          /*---------------------FUNCTIONS---------------------*/
  23          /***********************************************************************
  24          ** 函 数 名： InitUart1()
  25          ** 函数说明： 串口1异步通信初始化程序，选择定时器1
  26          **---------------------------------------------------------------------
  27          ** 输入参数： 无
  28          ** 返回参数： 无
  29          ***********************************************************************/
  30          void InitUart1()
  31          {
  32   1        SCON = 0x50; //(0101 0000) 工作方式为方式1,允许接收
  33   1        InitTime1();                                                                  
  34   1      }
  35          /***********************************************************************
  36          ** 函 数 名： UartSend1(unsigned char dat)
  37          ** 函数说明： 单字节发送程序
  38          **---------------------------------------------------------------------
  39          ** 输入参数： uint8
  40          ** 返回参数： 无
  41          ***********************************************************************/
  42          //
  43          void UartSend1(unsigned char dat)
  44          {
  45   1        SBUF=dat;
  46   1        while(!TI);
  47   1        TI=0;
  48   1      }
  49          /***********************************************************************
  50          ** 函 数 名： UartSend1_Byte(unsigned long int dat,unsigned char n)
  51          ** 函数说明： 多字节发送程序//先送低8位再送高8位
  52          **---------------------------------------------------------------------
  53          ** 输入参数： uint32（发送数据），uint8（发送数据字节数）
  54          ** 返回参数： 无
C51 COMPILER V9.00   URSTTEST                                                              07/20/2018 15:42:50 PAGE 2   

  55          ***********************************************************************/
  56          void UartSend1_Byte(unsigned long dat,unsigned char n)
  57          {
  58   1        unsigned char i,ch;
  59   1        for(i=0;i<n;i++)
  60   1        {
  61   2          ch=dat;
  62   2          UartSend1(ch);
  63   2          dat=dat>>8;
  64   2        }
  65   1      }
  66          /***********************************************************************
  67          ** 函 数 名： UartSend1_str((char *dat)
  68          ** 函数说明： 多字节发送程序//先送低8位再送高8位
  69          **---------------------------------------------------------------------
  70          ** 输入参数： uint8（发送字符串的首地址）
  71          ** 返回参数： 无
  72          ***********************************************************************/
  73          void UartSend1_str(char *dat) 
  74          {
  75   1        while(*dat)
  76   1        {
  77   2          UartSend1(*dat);
  78   2          dat++;
  79   2        }
  80   1      }
  81          /***********************************************************************
  82          ** 函 数 名： InitUart2()
  83          ** 函数说明： 串口1异步通信初始化程序，选择定时器1
  84          **---------------------------------------------------------------------
  85          ** 输入参数： 无
  86          ** 返回参数： 无
  87          ***********************************************************************/
  88          void InitUart2()
  89          {
  90   1        S2CON = 0x50; //(0001 0000) 允许接收,9位数据，有起始与终止位 
  91   1        InitTime2();                                                                  
  92   1      }
  93          /***********************************************************************
  94          ** 函 数 名： UartSend2(unsigned char dat)
  95          ** 函数说明： 单字节发送程序
  96          **---------------------------------------------------------------------
  97          ** 输入参数： uint8
  98          ** 返回参数： 无
  99          ***********************************************************************/
 100          void UartSend2(char dat)
 101          {
 102   1        S2BUF=dat;
 103   1        Urst2TI=1;
 104   1        while(Urst2TI);
 105   1      }
 106          /***********************************************************************
 107          ** 函 数 名： UartSend2_str((char *dat)
 108          ** 函数说明： 多字节发送程序//先送低8位再送高8位
 109          **---------------------------------------------------------------------
 110          ** 输入参数： uint8（发送字符串的首地址）
 111          ** 返回参数： 无
 112          ***********************************************************************/
 113          void UartSend2_str(char *dat) 
 114          {
 115   1        while(*dat)
 116   1        {
C51 COMPILER V9.00   URSTTEST                                                              07/20/2018 15:42:50 PAGE 3   

 117   2          UartSend2(*dat);
 118   2          dat++;
 119   2        }
 120   1      }
 121          /***********************************************************************
 122          ** 函 数 名： UartRec2()
 123          ** 函数说明： 字符串接收程序
 124          **---------------------------------------------------------------------
 125          ** 输入参数： 接收字符串首地址
 126          ** 返回参数： uint8
 127          ***********************************************************************/
 128          uint8 UartRec2(char *p)
 129          {
 130   1        while(Urst2RI)
 131   1        {
 132   2          Urst2RI=0;
 133   2          Urst2Rec = S2BUF;
 134   2          *p=Urst2Rec;
 135   2          if(*p){Urst2RI=1;p++;}
 136   2          else  {Urst2RI=0;*p=0;return 1;}
 137   2        }
 138   1        return 0;
 139   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    180    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =      3       5
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
