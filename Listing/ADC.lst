C51 COMPILER V9.00   ADC                                                                   07/13/2018 11:16:28 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE ADC
OBJECT MODULE PLACED IN .\Output\ADC.obj
COMPILER INVOKED BY: E:\Program Files\keil5\C51\BIN\C51.EXE Drivers\ADC.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PR
                    -INT(.\Listing\ADC.lst) TABS(2) OBJECT(.\Output\ADC.obj)

line level    source

   1          /*****************************************************************
   2          **                   大连理工大学 创新创业学院
   3          **                       物联网应用工坊
   4          **---------------------------------------------------------------
   5          ** 项目名称：   WTZP1.0-BlueBerry
   6          ** 日    期：   2018-07-010
   7          ** 作    者：   王世许
   8          **---------------------------------------------------------------
   9          ** 文 件 名：   AD.c
  10          ** 文件说明：   AD转换
  11          *****************************************************************/
  12          /*---------------------INCLUDES----------------------*/
  13           #include "ADC.h"
  14          /*---------------------VARIABLES---------------------*/
  15          
  16          
  17          /*---------------------FUNCTIONS---------------------*/
  18          
  19          /***********************************************************************
  20          ** 函 数 名： Set_AD()
  21          ** 函数说明： 设置AD口
  22          **---------------------------------------------------------------------
  23          ** 输入参数： 无
  24          ** 返回参数： 无
  25          ***********************************************************************/
  26          
  27          void Init_AD()
  28          {
  29   1        P1M1 = 0x24; //0010 0100  设置P1.2 P1.5为ADC口
  30   1        P1M0 = 0x00; //0000 0000
  31   1      }
  32           
  33          /***********************************************************************
  34          ** 函 数 名： GetAD(uint8 n)
  35          ** 函数说明： AD转换
  36          **---------------------------------------------------------------------
  37          ** 输入参数： ADC拟通道设置
  38          ** 返回参数： ADC结果
  39          ***********************************************************************/
  40          uint16 GetAD(uint8 n)
  41          {
  42   1        uint16 v;
  43   1        ADCCFG=0x2F; //设置ADC时钟为系统时钟/2/16/16  0010 1111
  44   1        ADC_CONTR=0x80|n; //使能ADC模块 1000 0000
  45   1      
  46   1        ADC_CONTR|=0x40; //启动AD转换 0100 0000
  47   1        _nop_();
  48   1        _nop_();
  49   1        while(!(ADC_CONTR&0x20)); //查询ADC完成标志 0010 0000
  50   1        ADC_CONTR&=~0x20; //清完成标志
  51   1      
  52   1        v=(ADC_RES<<8)+ADC_RESL; //读取ADC结果
  53   1      
  54   1        return v; 
C51 COMPILER V9.00   ADC                                                                   07/13/2018 11:16:28 PAGE 2   

  55   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     43    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
