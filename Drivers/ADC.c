/*****************************************************************
**                   大连理工大学 创新创业学院
**                       物联网应用工坊
**---------------------------------------------------------------
** 项目名称：   WTZP1.0-BlueBerry
** 日    期：   2018-07-010
** 作    者：   王世许
**---------------------------------------------------------------
** 文 件 名：   AD.c
** 文件说明：   AD转换
*****************************************************************/
/*---------------------INCLUDES----------------------*/
 #include "ADC.h"
/*---------------------VARIABLES---------------------*/


/*---------------------FUNCTIONS---------------------*/

/***********************************************************************
** 函 数 名： Set_AD()
** 函数说明： 设置AD口
**---------------------------------------------------------------------
** 输入参数： 无
** 返回参数： 无
***********************************************************************/

void Init_AD()
{
	P1M1 = 0x24; //0010 0100  设置P1.2 P1.5为ADC口
  P1M0 = 0x00; //0000 0000
}
 
/***********************************************************************
** 函 数 名： GetAD(uint8 n)
** 函数说明： AD转换
**---------------------------------------------------------------------
** 输入参数： ADC拟通道设置
** 返回参数： ADC结果
***********************************************************************/
uint16 GetAD(uint8 n)
{
	uint16 v;
	ADCCFG=0x2F; //设置ADC时钟为系统时钟/2/16/16  0010 1111
	ADC_CONTR=0x80|n; //使能ADC模块 1000 0000

	ADC_CONTR|=0x40; //启动AD转换 0100 0000
	_nop_();
	_nop_();
	while(!(ADC_CONTR&0x20)); //查询ADC完成标志 0010 0000
	ADC_CONTR&=~0x20; //清完成标志

	v=(ADC_RES<<8)+ADC_RESL; //读取ADC结果

	return v; 
}
